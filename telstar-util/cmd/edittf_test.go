package cmd

import (
	"bitbucket.org/johnnewcombe/telstar-library/types"
	"testing"
)

// minimal frame type to use in frame validation
/*
type Frame struct {
	PID Pid `json:"pid" bson:"pid"`
}
func (f *Frame) IsValid() bool {
	return len(f.PID.FrameId) == 1
}
type Pid struct {
	PageNumber int    `json:"page-no" bson:"page-no"`
	FrameId    string `json:"frame-id" bson:"frame-id"`
}
*/

func Test_createEditTfFrame(t *testing.T) {
	type Test struct {
		description string
		inputPid    types.Pid
		inputFrame  string
		wantOk      bool
		wantLength  int
	}
	var tests = []Test{
		{"good frame", types.Pid{0, "a"}, "https://edit.tf/#0:QIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBA5b4UCAosWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgDVNGVBUizKdSDSQdtOTLv6ZfHRBz88-mXag080GFAgQIECANt35MvLcgw8OGzTjw9NO_cg6aMPRBw5b-2nJl5oMKBAgQIA3PTt4bMqDtpy98mHphX9tOTLv6ZfCDhsw9M2_ltQIECBAgDc9O3Tsw8kHTeg6aN_PKg6aMPRB3y8sqDhyy9suzLu6IECANk68tO7Og6aMqBi5bsOaDDuyIGLlww5rkCBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgDIECChsy4eeVBzy5Qejp04c3S9fn2YefPp08rse_agQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIA0HZ0y8t2Hpp7ZdnlBw2ZcPPKgzZcuxB03oM-Xog07kCBAgDdN_XHoQdtOEHq3Ze-PftxZeuuBn24dOxdj37UCBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIAVRAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECAFUAxQ0xAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgBVAMUNMCUw9RAgQIECBAgQIECBAgQIECBAgQIECBAgQIAVQDFDTAlMPUDQQdJAgQIECBAgQIECBAgQIECBAgQIECBAgQIA0wJTD1A0EHSQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIA9QNBB0kCBAgQIECBAgQIECBAgQICixYsWLFixYsWLFixAgQIAdJAgQICixYsWLFixYsWLFixYgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECA", true, 1362},
		{"bad frame", types.Pid{0, "a"}, "edit.tf/#0:QIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBA5b4UCAosWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgDVNGVBUizKdSDSQdtOTLv6ZfHRBz88-mXag080GFAgQIECANt35MvLcgw8OGzTjw9NO_cg6aMPRBw5b-2nJl5oMKBAgQIA3PTt4bMqDtpy98mHphX9tOTLv6ZfCDhsw9M2_ltQIECBAgDc9O3Tsw8kHTeg6aN_PKg6aMPRB3y8sqDhyy9suzLu6IECANk68tO7Og6aMqBi5bsOaDDuyIGLlww5rkCBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgDIECChsy4eeVBzy5Qejp04c3S9fn2YefPp08rse_agQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIA0HZ0y8t2Hpp7ZdnlBw2ZcPPKgzZcuxB03oM-Xog07kCBAgDdN_XHoQdtOEHq3Ze-PftxZeuuBn24dOxdj37UCBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIAVRAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECAFUAxQ0xAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgBVAMUNMCUw9RAgQIECBAgQIECBAgQIECBAgQIECBAgQIAVQDFDTAlMPUDQQdJAgQIECBAgQIECBAgQIECBAgQIECBAgQIA0wJTD1A0EHSQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIA9QNBB0kCBAgQIECBAgQIECBAgQICixYsWLFixYsWLFixAgQIAdJAgQICixYsWLFixYsWLFixYgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECA", false, 0},
	}
	// run tests
	for _, test := range tests {
		if got, err := createEditTfFrame(test.inputPid, test.inputFrame); len(got) != test.wantLength || test.wantOk == (err != nil) {
			t.Errorf(TEST_ERROR_MESSAGE, test.description)
		}
	}
}

func Test_isEditTfFrame(t *testing.T) {

	type Test struct {
		description string
		input       string
		wantOk      bool
	}
	var tests = []Test{
		{"valid page", "https://edit.tf/#0:QIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBA5b4UCAosWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgDVNGVBUizKdSDSQdtOTLv6ZfHRBz88-mXag080GFAgQIECANt35MvLcgw8OGzTjw9NO_cg6aMPRBw5b-2nJl5oMKBAgQIA3PTt4bMqDtpy98mHphX9tOTLv6ZfCDhsw9M2_ltQIECBAgDc9O3Tsw8kHTeg6aN_PKg6aMPRB3y8sqDhyy9suzLu6IECANk68tO7Og6aMqBi5bsOaDDuyIGLlww5rkCBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgDIECChsy4eeVBzy5Qejp04c3S9fn2YefPp08rse_agQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIA0HZ0y8t2Hpp7ZdnlBw2ZcPPKgzZcuxB03oM-Xog07kCBAgDdN_XHoQdtOEHq3Ze-PftxZeuuBn24dOxdj37UCBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIAVRAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECAFUAxQ0xAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgBVAMUNMCUw9RAgQIECBAgQIECBAgQIECBAgQIECBAgQIAVQDFDTAlMPUDQQdJAgQIECBAgQIECBAgQIECBAgQIECBAgQIA0wJTD1A0EHSQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIA9QNBB0kCBAgQIECBAgQIECBAgQICixYsWLFixYsWLFixAgQIAdJAgQICixYsWLFixYsWLFixYgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECA", true},
		{"valid page", "http://edit.tf/#0:QIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBA5b4UCAosWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgDVNGVBUizKdSDSQdtOTLv6ZfHRBz88-mXag080GFAgQIECANt35MvLcgw8OGzTjw9NO_cg6aMPRBw5b-2nJl5oMKBAgQIA3PTt4bMqDtpy98mHphX9tOTLv6ZfCDhsw9M2_ltQIECBAgDc9O3Tsw8kHTeg6aN_PKg6aMPRB3y8sqDhyy9suzLu6IECANk68tO7Og6aMqBi5bsOaDDuyIGLlww5rkCBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgDIECChsy4eeVBzy5Qejp04c3S9fn2YefPp08rse_agQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIA0HZ0y8t2Hpp7ZdnlBw2ZcPPKgzZcuxB03oM-Xog07kCBAgDdN_XHoQdtOEHq3Ze-PftxZeuuBn24dOxdj37UCBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIAVRAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECAFUAxQ0xAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgBVAMUNMCUw9RAgQIECBAgQIECBAgQIECBAgQIECBAgQIAVQDFDTAlMPUDQQdJAgQIECBAgQIECBAgQIECBAgQIECBAgQIA0wJTD1A0EHSQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIA9QNBB0kCBAgQIECBAgQIECBAgQICixYsWLFixYsWLFixAgQIAdJAgQICixYsWLFixYsWLFixYgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECA", true},
		{"in-valid page", "QIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBA5b4UCAosWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWLFixYsWIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgDVNGVBUizKdSDSQdtOTLv6ZfHRBz88-mXag080GFAgQIECANt35MvLcgw8OGzTjw9NO_cg6aMPRBw5b-2nJl5oMKBAgQIA3PTt4bMqDtpy98mHphX9tOTLv6ZfCDhsw9M2_ltQIECBAgDc9O3Tsw8kHTeg6aN_PKg6aMPRB3y8sqDhyy9suzLu6IECANk68tO7Og6aMqBi5bsOaDDuyIGLlww5rkCBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgDIECChsy4eeVBzy5Qejp04c3S9fn2YefPp08rse_agQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIA0HZ0y8t2Hpp7ZdnlBw2ZcPPKgzZcuxB03oM-Xog07kCBAgDdN_XHoQdtOEHq3Ze-PftxZeuuBn24dOxdj37UCBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIAVRAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECAFUAxQ0xAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgBVAMUNMCUw9RAgQIECBAgQIECBAgQIECBAgQIECBAgQIAVQDFDTAlMPUDQQdJAgQIECBAgQIECBAgQIECBAgQIECBAgQIA0wJTD1A0EHSQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIA9QNBB0kCBAgQIECBAgQIECBAgQICixYsWLFixYsWLFixAgQIAdJAgQICixYsWLFixYsWLFixYgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECBAgQIECA", false},
	}
	// run tests
	for _, test := range tests {
		if got := isEditTfFrame(test.input); got != test.wantOk {
			t.Errorf(TEST_ERROR_MESSAGE, test.description)
		}
	}
}
